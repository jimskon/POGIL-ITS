# C++ runner API + WebSockets (behind TLS vhost)
location /cxx-run/ {
  proxy_pass         http://127.0.0.1:5055/;   # trailing slash is important
  proxy_http_version 1.1;

  # REQUIRED for WebSockets:
  proxy_set_header   Upgrade $http_upgrade;
  proxy_set_header   Connection "upgrade";

  # Standard headers
  proxy_set_header   Host $host;
  proxy_set_header   X-Forwarded-Proto $scheme;
  proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;

  # Streaming + timeouts
  proxy_buffering off;
  proxy_read_timeout 600s;
  proxy_send_timeout 600s;

  client_max_body_size 256k;
  add_header X-Content-Type-Options nosniff always;
}
